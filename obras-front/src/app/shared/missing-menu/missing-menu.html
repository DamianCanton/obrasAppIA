<button
  pButton
  type="button"
  [label]="'Faltantes (' + totalCount() + ')'"
  severity="warn"
  class="w-full sm:w-auto"
  (click)="openDrawer()"
  [disabled]="totalCount() === 0"
></button>

<p-drawer
  header="Faltantes"
  [visible]="visible"
  (visibleChange)="visible = $event"
  position="right"
  [dismissible]="true"
  [style]="{ width: '22rem' }"
>
  <ng-template #content>
    <div class="flex align-items-center justify-content-between w-full pb-3 border-bottom-1 surface-border">
      <div class="text-sm text-700">
        Registrados: <b>{{ totalCount() }}</b>
        <span *ngIf="urgentCount() > 0">
          - Urgentes: <b>{{ urgentCount() }}</b>
        </span>
      </div>
      <button
        pButton
        type="button"
        label="Actualizar"
        size="small"
        severity="secondary"
        (click)="refresh()"
        [loading]="svc.loading()"
      ></button>
    </div>

    <div *ngIf="totalCount() === 0" class="py-4 text-sm text-600">
      No hay faltantes registrados.
    </div>

    <div *ngIf="totalCount() > 0" class="flex flex-column gap-3 pt-3 w-full">
      <p-message
        *ngFor="let m of urgentMissings()"
        severity="warn"
        variant="outlined"
        class="cursor-pointer"
        (click)="goToRegistry()"
      >
        <div class="flex flex-column gap-2 w-full">
          <div class="flex align-items-center justify-content-between w-full">
            <div class="flex align-items-center gap-2">
              <h4 class="text-xl m-0 text-900">{{ m.title }}</h4>
              <p-tag *ngIf="m.urgent" severity="danger" value="Urgente"></p-tag>
            </div>
            <div class="flex align-items-center gap-2 text-sm text-700">
              <span>Ver</span>
              <i class="pi pi-arrow-right"></i>
            </div>
          </div>

          <p class="text-sm text-700 m-0 line-clamp-3">
            {{ m.text }}
          </p>

          <div class="text-xs text-600">
            Obra #{{ m.construction?.id }} - Obrero:
            {{ m.constructionWorker.name || ('#' + m.constructionWorker.id) }}
            - {{ m.createdAt | date: 'short' }}
          </div>
        </div>
      </p-message>
    </div>
  </ng-template>
  <ng-template #footer>
    <div class="flex justify-content-center">
      <button pButton type="button" size="small" label="Ver registro" (click)="goToRegistry()"></button>
    </div>
  </ng-template>
</p-drawer>
